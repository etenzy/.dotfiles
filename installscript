#!/bin/bash

# Change dir to HOME
cd $HOME

# Hide "last login" line when starting a new terminal session
touch $HOME/.hushlogin

echo 'Install homebrew'
echo '----------------'
sudo rm -rf /usr/local/Cellar /usr/local/.git && brew cleanup
/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"

brew update

# Install zsh
echo 'Install oh-my-zsh'
echo '-----------------'
brew install zsh
rm -rf $HOME/.oh-my-zsh
rm $HOME/.zprofile
rm $HOME/.zshrc
curl -L https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh | sh

echo 'Install zplug'
echo '-------------'
brew install zplug

echo 'Install zsh-autosuggestions'
echo '---------------------------'
brew install zsh-autosuggestions

echo 'Install zsh-completions'
echo '-----------------------'
brew install zsh-completions
chmod go-w '$(brew --prefix)/share'
rm -f ~/.zcompdump; compinit

echo 'Install zsh-syntax-highlighting'
echo '-------------------------------'
brew install zsh-syntax-highlighting

echo 'Install spaceship-prompt'
echo '------------------------'
rm -rf ${ZSH_CUSTOM:=~/.oh-my-zsh/custom}/themes/spaceship.zsh-theme
rm -rf ${ZSH_CUSTOM:=~/.oh-my-zsh/custom}/themes/spaceship-prompt
git clone https://github.com/etenzy/spaceship-prompt.git ${ZSH_CUSTOM:=~/.oh-my-zsh/custom}/themes/spaceship-prompt
ln -nfs ${ZSH_CUSTOM:=~/.oh-my-zsh/custom}/themes/spaceship-prompt/spaceship.zsh-theme ${ZSH_CUSTOM:=~/.oh-my-zsh/custom}/themes/spaceship.zsh-theme

echo 'Install tmux'
echo '------------'
brew install tmux
git clone https://github.com/tmux-plugins/tpm $HOME/.tmux/plugins/tpm
 

# Add global gitignore
rm $HOME/.global-gitignore
ln -nfs $HOME/.dotfiles/global-gitignore $HOME/.global-gitignore
git config --global core.excludesfile $HOME/.global-gitignore

# Symlink zsh prefs
rm $HOME/.zshrc
ln -nfs $HOME/.dotfiles/shell/zshrc $HOME/.zshrc

rm $HOME/.zprofile
ln -nfs $HOME/.dotfiles/shell/zprofile $HOME/.zprofile

rm $HOME/.aliases
ln -nfs $HOME/.dotfiles/shell/aliases $HOME/.aliases

rm $HOME/.exports
ln -nfs $HOME/.dotfiles/shell/exports $HOME/.exports

rm $HOME/.functions
ln -nfs $HOME/.dotfiles/shell/functions $HOME/.functions

# Symlink bin
rm -rf $HOME/.bin
ln -nfs $HOME/.dotfiles/bin $HOME/.bin
chmod +x $HOME/.bin/*

# Symlink vim prefs
rm $HOME/.vimrc
ln -nfs $HOME/.dotfiles/shell/vimrc $HOME/.vimrc
#rm $HOME/.vim
#ln -nfs $HOME/.dotfiles/shell/vim $HOME/.vim

# Symlink the Mackup config
ln -s $HOME/.dotfiles/macos/mackup.cfg $HOME/.mackup.cfg

#Download https://github.com/ahmetb/kubectl-aliases/
curl https://raw.githubusercontent.com/ahmetb/kubectl-aliases/master/.kubectl_aliases -s -o ~/.kubectl_aliases

# Symlink yarn prefs
#rm $HOME/.yarnrc
#ln -nfs $HOME/.dotfiles/shell/.yarnrc $HOME/.yarnrc

echo 'Install php'
echo '-----------'
brew install php@7.2
brew install php@7.4

echo 'Install composer'
echo '----------------'
brew install composer

echo 'Install imagemagick'
echo '-------------------'
brew install imagemagick

echo 'Install imagick'
echo '---------------'
pecl install imagick

echo 'Install memcached'
echo '-----------------'
pecl install memcached

echo 'Install xdebug'
echo '--------------'
pecl install xdebug

echo 'Install php-redis'
echo '-------------'
pecl install redis

echo 'Install laravel envoy'
echo '---------------------'
composer global require "laravel/envoy=~1.0"

echo 'Install laravel valet'
echo '---------------------'
composer global require laravel/valet
valet install

echo 'Install PhpStorm'
echo '----------------'
brew cask install phpstorm

echo 'Install node'
echo '------------'
brew install node@10

echo 'Install yarn'
echo '------------'
brew install yarn

echo 'Install mklicense'
echo '-----------------'
npm install -g mklicense

echo 'Install visual-studio-code'
echo '--------------------------'
brew cask install visual-studio-code

echo 'Install ubersicht'
echo '-------------------'
brew cask install ubersicht
rm -rf "$HOME/Library/Application Support/Übersicht/widgets"
git clone git@github.com:etenzy/uebersicht-widgets.git "$HOME/Library/Application Support/Übersicht/widgets"

echo 'Install Software from Brewfile'
echo '------------------------------'
cd $HOME/.dotfiles
brew update
brew upgrade
brew bundle
brew cleanup

echo '++++++++++++++++++++++++++++++'
echo '++++++++++++++++++++++++++++++'
echo 'All done!'

echo '++++++++++++++++++++++++++++++'
echo 'Some optional tidbits'

chmod +x $HOME/.dotfiles/macos/set-defaults.sh
chmod +x $HOME/.dotfiles/macos/unset-defaults.sh
echo '1. Set some sensible macos defaults by running: $HOME/.dotfiles/macos/set-defaults.sh'
echo '2. Make a .dotfiles-custom/shell/.aliases for your personal commands'
echo '3. Download themes from nordtheme.com for matching styling

echo '++++++++++++++++++++++++++++++'
echo '++++++++++++++++++++++++++++++'
